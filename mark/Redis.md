### Redis

### 优化

* key尽量短小
* 对key进行分区，让每个集合都能满足max-ziplist-entries    和 max-ziplist-value 设置的最大值

####分布式锁

##### 操作方式

* Set key my_random_value nx px 3000

  set 随机值是防止在并发中，获得锁的线程A阻塞超时释放了锁，B获得了锁，然后A从阻塞中恢复，并释放了B的锁。

  非原子性操作都应由LUA 脚本来执行，保证原子性。

  ##### 问题点

  * redis 的主从复制是异步的，在主挂掉，主从切换期间。A线程已经获得了锁，B线程重新又获得了锁（主从复制，锁还未复制过来）
  * 在线程阻塞或者网络阻塞中，导致客户端获得的锁过期的情况。
  * 锁的超期时间（太长或者太短怎么办，如何设置合理的时间）
  * 
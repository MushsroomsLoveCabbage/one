### Mysql

------

#### 1.索引

##### 基本认识

* innodb 索引是B+树结构
* 索引只在适当的范围有助于查询
* InnoDB是聚集索引，数据文件是和索引绑在一起的，必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。而MyISAM是非聚集索引，数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的。

##### 索引类型

* 聚簇索引
  * 数据的存储方式，具体实现依赖于存储引擎
  * Innodb 中B+树索引和数据保存在一个结构中（相邻的数据和索引存在相同一页或者想临页，方便数据的范围查找，但是在数据插入时候也增加了开销（分页））
  * 主键是聚簇索引
* 二级索引
  * 叶子节点存放的是主键值，而不是主键物理位移值

#### 3.同步

* `semi-sync`主在同步binlog 日志给从库的时候需要从库写入本地的relay log 中返回ACK给主，主以此来确认写完成。
* **`并行复制`** 从库启用多个线程来重放relay log。





#### **4. Delete, Truncate, Drop** 

- Delete  是 DML ,操作需要放到rollback segment 中
- Truncate（删数据）, Drop （删表）是 DDL
- 数据量 16KB * 16KB / 14 Byte 



#### 安装

**注意点**

* 使用管理员权限操作
* 手动创建配置.ini文件

**命令**

* mysqld install
* mysqld --initialize-insecure

##### Cascading Aborts

#### two phase-lock

- 事务开启后，会依次有加锁解锁阶段，加锁阶段只能加或者升级锁，解锁阶段只能解锁或者降级锁

***stict two phase lock***

- 显式的标记rollback/commit 为解锁阶段(事务太过复杂，数据库无法判断什么时候是主动的判定什么时候是加锁或者解锁阶段)

#### 事务隔离

- 死锁是发生在写数据阶段（写锁）排他锁


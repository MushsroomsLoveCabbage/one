### Redis

#### 1. 缓存问题

##### 1.1 缓存穿透

* 过滤非法请求（BloomFilter）
* 不存在的值设置一个默认空值

##### 1.2 缓存击穿

* 对热点数据不做过期处理

##### 1.3 缓存雪崩

* 系统提供高可用，集群模式
* 请求限流，降级

------

### [Cache Aside Pattern](https://shishan100.gitee.io/docs/#/./docs/high-concurrency/redis-consistence?id=cache-aside-pattern)

最经典的缓存+数据库读写的模式，就是 Cache Aside Pattern。

- 读的时候，先读缓存，缓存没有的话，就读数据库，然后取出数据后放入缓存，同时返回响应。
- 更新的时候，**先更新数据库，然后再删除缓存**。

### 优化

* key尽量短小
* 对key进行分区，让每个集合都能满足max-ziplist-entries    和 max-ziplist-value 设置的最大值(value 在适合的大小范围内可以使用压缩格式，减小内存使用)

#### 分布式锁

##### 操作方式

* Set key my_random_value nx px 3000

  set 随机值是防止在并发中，获得锁的线程A阻塞超时释放了锁，B获得了锁，然后A从阻塞中恢复，并释放了B的锁。

  非原子性操作都应由LUA 脚本来执行，保证原子性。

  ##### 问题点

  * redis 的主从复制是异步的，在主挂掉，主从切换期间。A线程已经获得了锁，B线程重新又获得了锁（主从复制，锁还未复制过来）
  * 在线程阻塞或者网络阻塞中，导致客户端获得的锁过期的情况。
  * 锁的超期时间（太长或者太短怎么办，如何设置合理的时间）

##### 安装Redis

* windows 上安装 redis 最新版 搜索关键字  cygwin redis 5

##### 系统初始化

- 设置回调（在系统进程被Kill时触发）
- 加载配置
- 启动服务
- 监听端口
- 初始化相关资源和线程池等

##### 数据的删除处理主要有两种，一个是DEL命令的删除（采用Unlink 方式），一个是过期数据的删除

